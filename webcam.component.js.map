{"version":3,"file":"webcam.component.js","sourceRoot":"","sources":["../src/webcam.component.ts"],"names":[],"mappings":";;AAAA,sCAAmF;AACnF,8DAAyD;AACzD,yCAMoB;AAEpB,IAAM,QAAQ,GAAG,uIAA+H,CAAA;;;;;IAyC9I,yBAAoB,SAAuB,EAAU,OAAmB;QAApD,cAAS,GAAT,SAAS,CAAc;QAAU,YAAO,GAAP,OAAO,CAAY;kCArB1C,KAAK;+BACR,KAAK;0BACV,KAAK;oBAMX,YAAY;oCACY,KAAK;yBAGvB,IAAI,mBAAY,EAAE;uBAGpB,IAAI,mBAAY,EAAE;2BAGM,IAAI,mBAAY,EAAE;uBACf,IAAI,mBAAY,EAAE;KAEU;IAE3E,kCAAQ,GAAR;QACE,IAAI,CAAC,kBAAkB,GAAG,oBAAQ,EAAE,IAAE,IAAI,GAAG,IAAI,GAAG,KAAK,CAAA;QACzD,IAAI,CAAC,kBAAkB,GAAG,KAAK,CAAA;QAC/B,IAAI,CAAC,eAAe,GAAG,CAAC,CAAC,CAAC,mBAAO,CAAC,YAAY,IAAI,mBAAO,CAAC,YAAY,CAAC,YAAY,CAAC,CAAC;;;;KAKtF;IAED,yCAAe,GAAf;QAAA,iBAGC;QAFC,IAAI,CAAC,aAAa,EAAE,CAAA;QACpB,UAAU,CAAC,cAAI,OAAA,KAAI,CAAC,eAAe,EAAE,EAAtB,CAAsB,EAAE,CAAC,CAAC,CAAA;KAC1C;IAED;;OAEG;;;;IAEH,yCAAe;;;IAAf;QAAA,iBA6BC;QA5BC,IAAM,KAAK,GAAG,oBAAQ,EAAE,CAAA;;QAGxB,EAAE,CAAC,CAAC,CAAC,mBAAO,CAAC,YAAY,KAAK,SAAS,CAAC,IAAI,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC;YACpD,mBAAO,CAAC,YAAY,GAAG,EAAE,CAAC;SAC3B;;;;QAKD,EAAE,CAAC,CAAC,CAAC,mBAAO,CAAC,YAAY,IAAI,mBAAO,CAAC,YAAY,CAAC,YAAY,KAAK,SAAS,CAAC,IAAI,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC;YACzF,mBAAO,CAAC,YAAY,CAAC,YAAY,GAAG,UAAA,WAAW;gBAC7C,MAAM,CAAC,IAAI,OAAO,CAAC,UAAC,OAAO,EAAE,MAAM;oBACjC,IAAM,SAAS,GAAG,KAAK,CAAC,IAAI,CAAC,mBAAO,EAAE,WAAW,EAAE,OAAO,EAAE,MAAM,CAAC,CAAC;oBAEpE,EAAE,CAAA,CAAE,SAAS,CAAC,IAAK,CAAC,CAAA,CAAC;wBACnB,SAAS,CAAC,IAAI,CAAE,UAAA,MAAM,IAAE,OAAA,KAAI,CAAC,WAAW,CAAC,MAAM,CAAC,EAAxB,CAAwB,CAAE,CAAA;qBACnD;iBACF,CAAC,CAAA;aACH,CAAA;SACF;;QAGD,UAAU,CAAC,cAAI,OAAA,KAAI,CAAC,SAAS,CAAC,IAAI,CAAC,KAAI,CAAC,EAAzB,CAAyB,EAAE,CAAC,CAAC,CAAA;QAE5C,IAAI,CAAC,kBAAkB,EAAE,CAAA;QACzB,IAAI,CAAC,mBAAmB,EAAE,CAAC;QAC3B,IAAI,CAAC,QAAQ,EAAE,CAAA;KAChB;IAED,qCAAW,GAAX,UAAY,MAAM;QAChB,IAAM,QAAQ,GAAG,IAAI,CAAC,WAAW,EAAE,CAAA;QACnC,QAAQ,CAAC,SAAS,GAAG,MAAM,CAAA;KAC5B;IAED,4CAAkB,GAAlB;QAAA,iBAaC;QAZC,IAAI,CAAC,QAAQ,GAAG,IAAI,gBAAgB,CAAE,cAAI,OAAA,KAAI,CAAC,WAAW,EAAE,EAAlB,CAAkB,CAAE,CAAA;QAE9D,IAAM,MAAM,GAAG;YACb,UAAU,EAAE,IAAI;YAChB,SAAS,EAAE,IAAI;YACf,aAAa,EAAE,IAAI;YACnB,gBAAgB;SACjB,CAAA;QACD,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,IAAI,CAAC,OAAO,CAAC,aAAa,EAAE,MAAM,CAAC,CAAC;QAE1D,IAAI,CAAC,QAAQ,GAAG,cAAW,IAAI,CAAC,WAAW,EAAE,CAAA,EAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAA;QACzD,MAAM,CAAC,gBAAgB,CAAC,QAAQ,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAA;KACjD;IAED,uCAAa,GAAb;QACE,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,OAAO,IAAa,EAAE,CAAA;QAC1C,IAAI,CAAC,OAAO,CAAC,WAAW,GAAG,IAAI,CAAC,OAAO,CAAC,WAAW,IAAI,uBAAuB,CAAC;QAC/E,IAAI,CAAC,OAAO,CAAC,YAAY,GAAG,IAAI,CAAC,OAAO,CAAC,YAAY,IAAI,UAAU,CAAC;QACpE,IAAI,CAAC,OAAO,CAAC,eAAe,GAAG,IAAI,CAAC,OAAO,CAAC,eAAe,IAAI,GAAG,CAAC;QACnE,IAAI,CAAC,OAAO,CAAC,UAAU,GAAG,IAAI,CAAC,OAAO,CAAC,UAAU,IAAK,OAAO,CAAC;QAC9D,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,OAAO,CAAC,QAAQ,IAAI,CAAC,CAAC,IAAI,CAAC,kBAAkB,IAAI,CAAC,IAAI,CAAC,eAAe,IAAI,IAAI,CAAC,OAAO,CAAC,WAAW,CAAC,GAAG,IAAI,GAAG,KAAK,CAAA;QAEzI,EAAE,CAAA,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,KAAK,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,CAAA,CAAC;YAC7C,IAAI,CAAC,OAAO,CAAC,KAAK,GAAG,IAAI,CAAA;SAC1B;KACF;IAED;;;OAGG;;;;;IACH,kCAAQ;;;;IAAR;QAAA,iBAkBC;;QAhBC,EAAE,CAAC,CAAC,mBAAO,CAAC,YAAY,CAAC,gBAAgB,IAAI,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC;YAChE,IAAM,YAAU,GAAG,IAAI,CAAC,OAAO,CAAC,UAAU,CAAC;YAC3C,mBAAO,CAAC,YAAY,CAAC,gBAAgB,EAAE,CAAC,IAAI,CAAC,UAAC,OAAO;gBACnD,OAAO,CAAC,OAAO,CAAC,UAAC,MAAmB;oBAClC,EAAE,CAAC,CAAC,MAAM,IAAI,MAAM,CAAC,IAAI,KAAK,YAAY,CAAC,CAAC,CAAC;wBAC3C,EAAE,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,WAAW,EAAE,CAAC,MAAM,CAAC,YAAU,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;4BACvD,KAAI,CAAC,OAAO,CAAC,KAAK,GAAG,EAAC,QAAQ,EAAE,EAAC,KAAK,EAAE,MAAM,CAAC,QAAQ,EAAC,EAAE,UAAU,EAAE,aAAa,EAAC,CAAC;yBACtF;qBACF;iBACF,CAAC,CAAC;gBACH,KAAI,CAAC,SAAS,EAAE,CAAC;aAClB,CAAC,CAAC;SACJ;QACD,IAAI,CAAC,CAAC;YACJ,IAAI,CAAC,SAAS,EAAE,CAAC;SAClB;KACF;IAED,qCAAW,GAAX;QACE,IAAM,KAAK,GAAG,IAAI,CAAC,WAAW,EAAE,CAAC;QAEjC,EAAE,CAAA,CAAC,CAAC,KAAK,CAAC;YAAA,MAAM,CAAA;QAEhB,KAAK,CAAC,KAAK,GAAG,CAAC,CAAC;QAChB,KAAK,CAAC,MAAM,GAAG,CAAC,CAAC;QAEjB,IAAM,GAAG,GAAG,IAAI,CAAC,oBAAoB,GAAG,IAAI,CAAC,OAAO,CAAC,aAAa,CAAC,UAAU,GAAG,IAAI,CAAC,OAAO,CAAC,aAAa,CAAA;QAE1G,IAAI,KAAK,GAAG,IAAI,CAAC,OAAO,CAAC,KAAK,IAAI,QAAQ,CAAC,GAAG,CAAC,WAAW,EAAE,EAAE,CAAC,CAAA;QAC/D,IAAI,MAAM,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,IAAI,QAAQ,CAAC,GAAG,CAAC,YAAY,EAAE,EAAE,CAAC,CAAA;QAElE,EAAE,CAAA,CAAC,CAAC,KAAK,IAAI,CAAC,MAAM,CAAC,CAAA,CAAC;YACpB,KAAK,GAAG,GAAG,CAAA;YACX,MAAM,GAAG,GAAG,CAAA;SACb;QAED,KAAK,CAAC,KAAK,GAAG,KAAK,CAAA;QACnB,KAAK,CAAC,MAAM,GAAG,MAAM,CAAA;KACtB;IAED,4CAAkB,GAAlB,UAAmB,KAAK;QACtB,KAAK,GAAG,KAAK,IAAI,IAAI,CAAC,WAAW,EAAE,CAAA;QACnC,IAAM,GAAG,GAAG,EAAC,KAAK,EAAC,CAAC,EAAE,MAAM,EAAC,CAAC,EAAC,CAAA;QAE/B,EAAE,CAAA,CAAC,KAAK,CAAC,UAAU,CAAC,CAAA,CAAC;YACnB,GAAG,CAAC,KAAK,GAAG,KAAK,CAAC,UAAU,CAAA;YAC5B,GAAG,CAAC,MAAM,GAAG,KAAK,CAAC,WAAW,CAAA;SAC/B;QAAA,IAAI,CAAA,CAAC;YACJ,GAAG,CAAC,KAAK,GAAG,IAAI,CAAC,OAAO,CAAC,KAAK,IAAI,QAAQ,CAAC,IAAI,CAAC,OAAO,CAAC,aAAa,CAAC,WAAW,EAAE,EAAE,CAAC,CAAA;YACtF,GAAG,CAAC,MAAM,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,IAAI,QAAQ,CAAC,IAAI,CAAC,OAAO,CAAC,aAAa,CAAC,YAAY,EAAE,EAAE,CAAC,CAAA;SAC1F;QAED,EAAE,CAAA,CAAC,CAAC,GAAG,CAAC,KAAK,CAAC;YAAA,GAAG,CAAC,KAAK,GAAG,GAAG,CAAA;QAC7B,EAAE,CAAA,CAAC,CAAC,GAAG,CAAC,MAAM,CAAC;YAAA,GAAG,CAAC,MAAM,GAAG,GAAG,CAAA;QAE/B,MAAM,CAAC,GAAG,CAAA;KACX;IAED,qCAAW,GAAX;QACE,IAAM,MAAM,GAAG,IAAI,CAAC,OAAO,CAAC,aAAa,CAAA;QACzC,IAAM,OAAO,GAAG,IAAI,CAAC,UAAU,GAAG,QAAQ,GAAG,OAAO,CAAA;QACpD,MAAM,CAAC,MAAM,CAAC,oBAAoB,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAA;KAC/C;IAED;;;OAGG;;;;;IACH,mCAAS;;;;IAAT;QAAA,iBA4CC;;;QAzCC,IAAI,YAAY,GAAG,EAAE,KAAK,EAAE,KAAK,EAAE,KAAK,EAAE,KAAK,EAAE,CAAC;QAClD,IAAI,YAAY,GAAG,EAAE,CAAC;QAEtB,EAAE,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC;YACvB,YAAY,CAAC,KAAK,GAAG,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC;YACxC,YAAY,GAAG,OAAO,CAAC;SACxB;QAED,EAAE,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,KAAK,KAAK,IAAI,CAAC,CAAC,CAAC;YAChC,YAAY,CAAC,KAAK,GAAG,IAAI,CAAC;YAC1B,EAAE,CAAC,CAAC,YAAY,KAAK,EAAE,CAAC,CAAC,CAAC;gBACxB,YAAY,GAAG,YAAY,GAAG,IAAI,CAAC;aACpC;YACD,YAAY,GAAG,YAAY,GAAG,OAAO,CAAC;SACvC;;QAGD,IAAM,qBAAqB,GAAG;YAC5B,MAAM,CAAC,IAAI,OAAO,CAAS,UAAC,OAAO,EAAE,MAAM;gBACzC,IAAI,CAAC;oBACH,mBAAO,CAAC,YAAY,CAAC,YAAY,CAAC,YAAY,CAAC;yBAC9C,IAAI,CAAC,UAAC,MAAW,IAAK,OAAA,OAAO,CAAC,MAAM,CAAC,EAAf,CAAe,CAAC;yBACtC,KAAK,CAAC,UAAC,MAAW;wBACjB,MAAM,CAAC,MAAM,CAAC,CAAA;qBACf,CAAC,CAAA;iBACH;gBAAC,KAAK,CAAC,CAAC,CAAC,EAAE,CAAC;oBACX,MAAM,CAAC,CAAC,CAAC,CAAC;iBACX;aACF,CAAC,CAAC;SACJ,CAAC;QAEF,qBAAqB,EAAE;aACtB,IAAI,CAAC,UAAA,MAAM;YACV,KAAI,CAAC,WAAW,CAAC,MAAM,CAAC,CAAA;YACxB,KAAI,CAAC,cAAc,CAAC,MAAM,CAAC,CAAA;YAC3B,KAAI,CAAC,MAAM,GAAG,MAAM,CAAA;SACrB,CAAC,CAAC,KAAK,CAAC,UAAA,GAAG;YACV,KAAI,CAAC,WAAW,CAAC,IAAI,CAAC,KAAI,CAAC,KAAK,GAAC,GAAG,CAAC,CAAA;YACrC,KAAI,CAAC,OAAO,CAAC,IAAI,CAAC,GAAG,CAAC,CAAA;YACtB,MAAM,CAAC,OAAO,CAAC,MAAM,CAAC,GAAG,CAAC,CAAA;SAC3B,CAAC,CAAA;KACH;IAED,wCAAc,GAAd,UAAe,MAAO;QACpB,EAAE,CAAC,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC;YACpB,IAAI,CAAC,aAAa,EAAE,CAAA;SACrB;QAAA,IAAI,CAAA,CAAC;YACJ,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,MAAM,CAAC,CAAA;SAC1B;KACF;IAED;;;OAGG;;;;;IACH,6CAAmB;;;;IAAnB;QACE,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,UAAU,IAAI,IAAI,CAAC,eAAe,CAAC,CAAC,CAAC;YAC7C,MAAM,CAAC,IAAI,CAAC,QAAQ,EAAE,CAAC;SACxB;QAED,MAAM,CAAC,IAAI,CAAC,cAAc,EAAE,CAAA;KAC7B;IAED,qCAAW,GAAX;QACE,IAAI,CAAC,QAAQ,CAAC,UAAU,EAAE,CAAA;QAC1B,MAAM,CAAC,mBAAmB,CAAC,QAAQ,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAA;QAEnD,IAAM,GAAG,GAAG,IAAI,CAAC,WAAW,EAAE,CAAA;QAE9B,EAAE,CAAA,CAAC,GAAG,IAAI,GAAG,CAAC,KAAK,CAAC,CAAA,CAAC;YACnB,GAAG,CAAC,KAAK,EAAE,CAAA;SACZ;QAED,EAAE,CAAA,CAAE,IAAI,CAAC,MAAO,CAAC,CAAA,CAAC;YAChB,IAAI,CAAC,MAAM,CAAC,SAAS,EAAE,CAAC,OAAO,CAAC,UAAA,KAAK,IAAE,OAAA,KAAK,CAAC,IAAI,EAAE,EAAZ,CAAY,CAAC,CAAA;;SAErD;KACF;IAED,mCAAS,GAAT;QACE,MAAM,CAAC,QAAQ,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAA;KACxC;IAED,mEAAmE;;IACnE,mCAAS;IAAT,UAAU,IAAK;QACb,EAAE,CAAA,CAAC,IAAI,CAAC,UAAU,CAAC,CAAA,CAAC;YAClB,MAAM,CAAC,IAAI,CAAC,WAAW,CAAC,aAAa,CAAC,IAAI,IAAE,IAAI,CAAC,IAAI,CAAC,CAAA;;SAEvD;QAAA,IAAI,CAAA,CAAC;YACJ,IAAM,MAAM,GAAG,IAAI,CAAC,SAAS,EAAE,CAAA;YAC/B,IAAM,KAAK,GAAG,IAAI,CAAC,WAAW,EAAE,CAAA;YAChC,IAAI,CAAC,cAAc,CAAC,MAAM,EAAE,KAAK,CAAC,CAAA;YAClC,MAAM,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC,SAAS,CAAC,KAAK,EAAE,CAAC,EAAE,CAAC,CAAC,CAAA;YAC9C,MAAM,CAAC,OAAO,CAAC,OAAO,CAAE,MAAM,CAAC,SAAS,CAAC,IAAI,CAAC,CAAE,CAAA;SACjD;KACF;IAED,wCAAc,GAAd,UAAe,MAAO,EAAE,KAAM;QAC5B,IAAM,EAAE,GAAG,IAAI,CAAC,kBAAkB,CAAC,KAAK,CAAC,CAAA;QACzC,MAAM,GAAG,MAAM,IAAI,IAAI,CAAC,SAAS,EAAE,CAAA;QACnC,MAAM,CAAC,KAAK,GAAG,EAAE,CAAC,KAAK,CAAA;QACvB,MAAM,CAAC,MAAM,GAAG,EAAE,CAAC,MAAM,CAAA;KAC1B;IAED,gIAAgI;;IAChI,wCAAc;IAAd;QACE,IAAM,MAAM,GAAG,QAAQ,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAA;QAC/C,MAAM,CAAC,SAAS,GAAG,4BAA4B,CAAA;QAC/C,MAAM,CAAC,YAAY,CAAC,MAAM,EAAC,+BAA+B,CAAC,CAAA;QAC3D,MAAM,CAAC,YAAY,CAAC,MAAM,EAAC,IAAI,CAAC,OAAO,CAAC,WAAW,CAAC,CAAA;QAEpD,IAAI,QAAQ,GAAG,QAAQ,CAAC,aAAa,CAAC,OAAO,CAAC,CAAA;QAC9C,QAAQ,CAAC,YAAY,CAAC,MAAM,EAAC,WAAW,CAAC,CAAA;QACzC,QAAQ,CAAC,YAAY,CAAC,OAAO,EAAC,+BAA+B,CAAC,CAAA;QAC9D,MAAM,CAAC,WAAW,CAAE,QAAQ,CAAE,CAAA;QAE9B,QAAQ,GAAG,QAAQ,CAAC,aAAa,CAAC,OAAO,CAAC,CAAA;QAC1C,QAAQ,CAAC,YAAY,CAAC,MAAM,EAAC,mBAAmB,CAAC,CAAA;QACjD,QAAQ,CAAC,YAAY,CAAC,OAAO,EAAC,QAAQ,CAAC,CAAA;QACvC,MAAM,CAAC,WAAW,CAAE,QAAQ,CAAE,CAAA;QAE9B,QAAQ,GAAG,QAAQ,CAAC,aAAa,CAAC,OAAO,CAAC,CAAA;QAC1C,QAAQ,CAAC,YAAY,CAAC,MAAM,EAAC,OAAO,CAAC,CAAA;QACrC,QAAQ,CAAC,YAAY,CAAC,OAAO,EAAC,IAAI,CAAC,OAAO,CAAC,WAAW,CAAC,CAAA;QACvD,MAAM,CAAC,WAAW,CAAE,QAAQ,CAAE,CAAA;QAE9B,IAAM,GAAG,GAAG,IAAI,CAAC,OAAO,CAAC,aAAa,CAAC,oBAAoB,CAAC,QAAQ,CAAC,CAAC;QACtE,EAAE,CAAA,CAAC,GAAG,CAAC,MAAM,CAAC,CAAA,CAAC;YACb,IAAI,CAAC,OAAO,CAAC,aAAa,CAAC,WAAW,CAAE,GAAG,CAAC,CAAC,CAAC,CAAE,CAAA;SACjD;QAED,IAAI,CAAC,OAAO,CAAC,aAAa,CAAC,WAAW,CAAE,MAAM,CAAE,CAAA;QAEhD,MAAM,CAAC,MAAM,CAAA;KACd;IAED;;OAEG;;;;IACH,uCAAa;;;IAAb;QACE,IAAI,CAAC,UAAU,GAAG,IAAI,CAAA;QACtB,IAAM,MAAM,GAAG,IAAI,CAAC,WAAW,EAAE,IAAI,IAAI,CAAC,cAAc,EAAE,CAAA;QAC1D,IAAI,CAAC,WAAW,GAAG,IAAI,oBAAQ,CAAE,MAAM,CAAE,CAAA;KAC1C;IAED,+BAA+B;;IAC/B,2CAAiB;IAAjB,UAAkB,OAAyD;QACzE,OAAO,GAAG,OAAO,IAAI,EAAE,CAAA;QACvB,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,IAAI,CAAC;aAClC,IAAI,CAAE,UAAA,MAAM,IAAE,OAAA,6BAAiB,CAAC,MAAM,EAAE,EAAC,QAAQ,EAAC,OAAO,CAAC,QAAQ,EAAC,CAAC,EAAtD,CAAsD,CAAE,CAAA;KACxE;IAED,2CAAiB,GAAjB,UAAkB,MAAM,EAAE,OAAO;QAC/B,MAAM,CAAC,6BAAiB,CAAC,MAAM,EAAE,EAAC,QAAQ,EAAC,OAAO,CAAC,QAAQ,EAAC,CAAC,CAAA;KAC9D;;gBAxVF,gBAAS,SAAC;oBACT,QAAQ,EAAE,YAAY;oBACtB,QAAQ,EAAE,QAAQ;oBAClB,QAAQ,EAAE,QAAQ;iBACnB;;;;gBA1BQ,+BAAY;gBADD,iBAAU;;;yBAsC3B,YAAK;yCACL,YAAK;wBAEL,YAAK;8BACL,aAAM;4BAEN,YAAK;4BACL,aAAM;0BAEN,YAAK;gCACL,aAAM;4BACN,aAAM,SAAC,OAAO;;0BAjDjB;;AA2BgB,0CAAe","sourcesContent":["import { Component, ElementRef, Input, Output, EventEmitter } from '@angular/core';\nimport { DomSanitizer } from '@angular/platform-browser';\nimport {\n  browser,\n  getMedia,\n  Options,\n  dataUriToFormData,\n  Fallback\n} from \"./videoHelp\"\n\nconst template = `<video id=\"video\" *ngIf=\"(isSupportUserMedia||isSupportWebRTC)\" autoplay=\"\" playsinline=\"\">Video stream not available</video>`\n/**\n * https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices\n */\nexport interface MediaDevice {\n  deviceId: string;\n  kind: string;\n  label: string;\n}\n\n/**\n * Render WebCam Component\n */\n@Component({\n  selector: 'ack-webcam',\n  template: template,\n  exportAs: 'webcam'\n}) export class WebCamComponent {\n  flashPlayer:Fallback\n  videoSrc: any\n  isSupportUserMedia: boolean = false\n  isSupportWebRTC: boolean = false\n  isFallback: boolean = false\n  browser: any\n  observer:MutationObserver\n  onResize\n  stream\n  \n  @Input() mime = 'image/jpeg'\n  @Input() useParentWidthHeight:boolean = false\n\n  @Input() ref\n  @Output() refChange = new EventEmitter()\n  \n  @Input() options: Options;\n  @Output() success = new EventEmitter()\n  \n  @Input() error:Error\n  @Output() errorChange:EventEmitter<Error> = new EventEmitter()\n  @Output('catch') catcher:EventEmitter<Error> = new EventEmitter()\n\n  constructor(private sanitizer: DomSanitizer, private element: ElementRef){}\n\n  ngOnInit(){\n    this.isSupportUserMedia = getMedia()!=null ? true : false\n    this.isSupportUserMedia = false\n    this.isSupportWebRTC = !!(browser.mediaDevices && browser.mediaDevices.getUserMedia);\n\n    //this.element.nativeElement.style.display='block'\n    //this.element.nativeElement.style.width='100%'\n    //this.element.nativeElement.style.height='100%'\n  }\n\n  ngAfterViewInit() {\n    this.applyDefaults()\n    setTimeout(()=>this.afterInitCycles(), 0)\n  }\n\n  /*ngOnChanges() {\n    this.onResize()\n  }*/\n\n  afterInitCycles(){\n    const media = getMedia()\n\n    // Older browsers might not implement mediaDevices at all, so we set an empty object first\n    if ((browser.mediaDevices === undefined) && !!media) {\n      browser.mediaDevices = {};\n    }\n\n    // Some browsers partially implement mediaDevices. We can't just assign an object\n    // with getUserMedia as it would overwrite existing properties.\n    // Here, we will just add the getUserMedia property if it's missing.\n    if ((browser.mediaDevices && browser.mediaDevices.getUserMedia === undefined) && !!media) {\n      browser.mediaDevices.getUserMedia = constraints=>{\n        return new Promise((resolve, reject)=>{\n          const userMedia = media.call(browser, constraints, resolve, reject);\n\n          if( userMedia.then ){\n            userMedia.then( stream=>this.applyStream(stream) )\n          }\n        })\n      }\n    }\n\n    //deprecated. use angular hash template referencing    \n    setTimeout(()=>this.refChange.emit(this), 0)\n\n    this.createVideoResizer()\n    this.startCapturingVideo();\n    this.onResize()\n  }\n\n  applyStream(stream){\n    const videoElm = this.getVideoElm()\n    videoElm.srcObject = stream\n  }\n\n  createVideoResizer(){\n    this.observer = new MutationObserver( ()=>this.resizeVideo() )\n    \n    const config = {\n      attributes: true,\n      childList: true,\n      characterData: true\n      //,subtree: true\n    }\n    this.observer.observe(this.element.nativeElement, config);\n\n    this.onResize = function(){this.resizeVideo()}.bind(this)\n    window.addEventListener('resize', this.onResize)\n  }\n\n  applyDefaults(){\n    this.options = this.options || <Options>{}\n    this.options.fallbackSrc = this.options.fallbackSrc || 'jscam_canvas_only.swf';\n    this.options.fallbackMode = this.options.fallbackMode || 'callback';\n    this.options.fallbackQuality = this.options.fallbackQuality || 200;\n    this.options.cameraType = this.options.cameraType  || 'front';\n    this.isFallback = this.options.fallback || (!this.isSupportUserMedia && !this.isSupportWebRTC && this.options.fallbackSrc) ? true : false\n\n    if(!this.options.video && !this.options.audio){\n      this.options.video = true\n    }\n  }\n\n  /**\n   * Switch to facing mode and setup web camera\n   * @returns {void}\n   */\n  onWebRTC(): any {\n    // https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/enumerateDevices\n    if (browser.mediaDevices.enumerateDevices && this.options.video) {\n      const cameraType = this.options.cameraType;\n      browser.mediaDevices.enumerateDevices().then((devices) => {\n        devices.forEach((device: MediaDevice) => {\n          if (device && device.kind === 'videoinput') {\n            if (device.label.toLowerCase().search(cameraType) > -1) {\n              this.options.video = {deviceId: {exact: device.deviceId}, facingMode: 'environment'};\n            }\n          }\n        });\n        this.setWebcam();\n      });\n    }\n    else {\n      this.setWebcam();\n    }\n  }\n\n  resizeVideo(){\n    const video = this.getVideoElm();\n    \n    if(!video)return\n\n    video.width = 0;\n    video.height = 0;\n    \n    const elm = this.useParentWidthHeight ? this.element.nativeElement.parentNode : this.element.nativeElement\n\n    let width = this.options.width || parseInt(elm.offsetWidth, 10)\n    let height = this.options.height || parseInt(elm.offsetHeight, 10)\n\n    if(!width || !height){\n      width = 320\n      height = 240\n    }\n\n    video.width = width\n    video.height = height\n  }\n\n  getVideoDimensions(video){\n    video = video || this.getVideoElm()\n    const dim = {width:0, height:0}\n\n    if(video.videoWidth){\n      dim.width = video.videoWidth\n      dim.height = video.videoHeight\n    }else{\n      dim.width = this.options.width || parseInt(this.element.nativeElement.offsetWidth, 10)\n      dim.height = this.options.height || parseInt(this.element.nativeElement.offsetHeight, 10)\n    }\n\n    if(!dim.width)dim.width = 320\n    if(!dim.height)dim.height = 240\n\n    return dim\n  }\n\n  getVideoElm(){\n    const native = this.element.nativeElement\n    const elmType = this.isFallback ? 'object' : 'video'\n    return native.getElementsByTagName(elmType)[0]\n  }\n\n  /**\n   * Setup web camera using native browser API\n   * @returns {void}\n   */\n  setWebcam(): any {\n    // constructing a getUserMedia config-object and\n    // an string (we will try both)\n    let optionObject = { audio: false, video: false };\n    let optionString = '';\n\n    if (this.options.video) {\n      optionObject.video = this.options.video;\n      optionString = 'video';\n    }\n\n    if (this.options.audio === true) {\n      optionObject.audio = true;\n      if (optionString !== '') {\n        optionString = optionString + ', ';\n      }\n      optionString = optionString + 'audio';\n    }\n\n    // Promisify async callback's for angular2 change detection\n    const promisifyGetUserMedia = () => {\n      return new Promise<string>((resolve, reject) => {\n        try {\n          browser.mediaDevices.getUserMedia(optionObject)\n          .then((stream: any) => resolve(stream))\n          .catch((objErr: any) => {\n            reject(objErr)\n          })\n        } catch (e) {\n          reject(e);\n        }\n      });\n    };\n\n    promisifyGetUserMedia()\n    .then(stream=>{\n      this.applyStream(stream)\n      this.processSuccess(stream)\n      this.stream = stream\n    }).catch(err=>{\n      this.errorChange.emit(this.error=err)\n      this.catcher.emit(err)\n      return Promise.reject(err)\n    })\n  }\n\n  processSuccess(stream?){\n    if (this.isFallback) {\n      this.setupFallback()\n    }else{\n      this.success.emit(stream)\n    }\n  }\n\n  /**\n   * Start capturing video stream\n   * @returns {void}\n   */\n  startCapturingVideo(): any {\n    if (!this.isFallback && this.isSupportWebRTC) {\n      return this.onWebRTC();\n    }\n\n    return this.processSuccess()\n  }\n\n  ngOnDestroy(){\n    this.observer.disconnect()\n    window.removeEventListener('resize', this.onResize)\n\n    const vid = this.getVideoElm()\n\n    if(vid && vid.pause){\n      vid.pause()\n    }\n\n    if( this.stream ){\n      this.stream.getTracks().forEach(track=>track.stop())\n      //this.stream.getTracks()[0].stop();\n    }\n  }\n\n  getCanvas(){\n    return document.createElement('canvas')\n  }\n\n  /** returns promise . @mime - null=png . Also accepts image/jpeg */\n  getBase64(mime?){\n    if(this.isFallback){\n      return this.flashPlayer.captureBase64(mime||this.mime)\n      //return this.getFallbackBase64(mime)\n    }else{\n      const canvas = this.getCanvas()\n      const video = this.getVideoElm()\n      this.setCanvasWidth(canvas, video)\n      canvas.getContext('2d').drawImage(video, 0, 0)\n      return Promise.resolve( canvas.toDataURL(mime) )\n    }\n  }\n\n  setCanvasWidth(canvas?, video?){\n    const di = this.getVideoDimensions(video)\n    canvas = canvas || this.getCanvas()\n    canvas.width = di.width\n    canvas.height = di.height\n  }\n\n  /** older browsers (IE11) cannot dynamically apply most attribute changes to object elements. Use this method during fallback */\n  createVidElmOb(){\n    const rtnElm = document.createElement('object')\n    rtnElm.innerHTML = 'Video stream not available'\n    rtnElm.setAttribute('type','application/x-shockwave-flash')\n    rtnElm.setAttribute('data',this.options.fallbackSrc)\n\n    let paramVar = document.createElement('param')\n    paramVar.setAttribute('name','FlashVars')\n    paramVar.setAttribute('value','mode=callback&amp;quality=200')\n    rtnElm.appendChild( paramVar )\n\n    paramVar = document.createElement('param')\n    paramVar.setAttribute('name','allowScriptAccess')\n    paramVar.setAttribute('value','always')\n    rtnElm.appendChild( paramVar )\n\n    paramVar = document.createElement('param')\n    paramVar.setAttribute('name','movie')\n    paramVar.setAttribute('value',this.options.fallbackSrc)\n    rtnElm.appendChild( paramVar )\n\n    const obs = this.element.nativeElement.getElementsByTagName('object');\n    if(obs.length){\n      this.element.nativeElement.removeChild( obs[0] )\n    }\n\n    this.element.nativeElement.appendChild( rtnElm )\n\n    return rtnElm\n  }\n\n  /**\n   * Implement fallback external interface\n   */\n  setupFallback(): void {\n    this.isFallback = true\n    const vidElm = this.getVideoElm() || this.createVidElmOb()\n    this.flashPlayer = new Fallback( vidElm )\n  }\n\n  /** single image to FormData */\n  captureAsFormData(options?:{mime?:string, fileName?:string, form?:FormData}){\n    options = options || {}\n    return this.getBase64(options.mime)\n    .then( base64=>dataUriToFormData(base64, {fileName:options.fileName}) )\n  }\n\n  dataUriToFormData(base64, options){\n    return dataUriToFormData(base64, {fileName:options.fileName})\n  }\n}"]}