{"version":3,"file":"videoHelp.js","sourceRoot":"","sources":["../src/videoHelp.ts"],"names":[],"mappings":"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","sourcesContent":["import { EventEmitter } from \"@angular/core\"\n\nexport const browser = <any>navigator\nexport function getMedia(){\n  return browser.getUserMedia\n  || browser.webkitGetUserMedia\n  || browser.mozGetUserMedia\n  || browser.msGetUserMedia\n}\n\n/**\n * Component options structure interface\n */\nexport interface Options {\n  video: boolean | any\n  cameraType: 'front' | string | {\n    deviceId: {\n      exact: string\n    }\n    facingMode: 'environment' | string\n  }\n  audio: boolean\n  width: number\n  height: number\n  fallback:boolean\n  fallbackSrc: string\n  fallbackMode: string\n  fallbackQuality: number\n}\n\nexport interface VideoObject{\n  capture:Function,\n  save:Function,\n  appendChild:Function\n  classid?:string,\n  data?:{}\n}\n\nexport interface Canvas{\n  toDataURL:Function,\n  getContext:Function,\n  width,\n  height\n}\n\n/*\nexport interface MediaDevice{\n  deviceId: string\n  kind: \"videoinput\" | \"audioinput\" | string\n  label: string\n  groupId: string\n}*/\n\n\nexport function dataUriToBlob(dataURI) {\n  // convert base64/URLEncoded data component to raw binary data held in a string\n  var byteString;\n  if (dataURI.split(',')[0].indexOf('base64') >= 0){\n    byteString = atob(dataURI.split(',')[1]);\n  }else{\n    byteString = window['unescape'](dataURI.split(',')[1]);\n  }\n\n  // separate out the mime component\n  var mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0];\n  // write the bytes of the string to a typed array\n  var ia = new Uint8Array(byteString.length);\n  for (var i = 0; i < byteString.length; i++) {\n      ia[i] = byteString.charCodeAt(i);\n  }\n\n  return new Blob([ia], {type:mimeString});\n}\n\n/** single image to transmittable resource */\nexport function dataUriToFormData(\n  dataURI,\n  options?:{fileName?:string, form?:FormData}\n){\n  options = options || {}\n  options.form = options.form || new FormData()\n  options.form.append('file', dataUriToBlob(dataURI), options.fileName||'file.jpg');\n  return options.form\n}\n\nexport function drawImageArrayToCanvas( imgArray:string[] ):Canvas{\n  const canvas = document.createElement('canvas')\n\n  // const di = this.getVideoDimensions()\n  const ctx = canvas.getContext('2d');\n  const width = imgArray[0].split(';').length\n  const height = imgArray.length\n  canvas.width = width\n  canvas.height = height\n  ctx.clearRect(0, 0, width, height);\n\n  const externData = {\n    imgData: ctx.getImageData(0, 0, width, height),\n    pos: 0\n  };\n\n  let tmp = null;\n  for(let x=0; x < imgArray.length; ++x){\n    let col = imgArray[x].split(';')\n    for (let i = 0; i < width; i++) {\n      tmp = parseInt(col[i], 10);\n      externData.imgData.data[externData.pos + 0] = (tmp >> 16) & 0xff;\n      externData.imgData.data[externData.pos + 1] = (tmp >> 8) & 0xff;\n      externData.imgData.data[externData.pos + 2] = tmp & 0xff;\n      externData.imgData.data[externData.pos + 3] = 0xff;\n      externData.pos += 4;\n    }\n\n    /*if (externData.pos >= 4 * width * height) {\n      ctx.putImageData(externData.imgData, 0, 0);\n      externData.pos = 0;\n    }*/\n  }\n\n  ctx.putImageData(externData.imgData, 0, 0);\n\n  return canvas\n}\n\nexport class Fallback{\n  debug:Function\n  onCapture:Function\n  onSave:Function\n  videoObject:VideoObject\n  onImage = new EventEmitter()\n  \n  constructor(videoObject:VideoObject){\n    this.videoObject = videoObject\n    const dataImgArray = []\n\n    //method intended to live within window memory\n    this.debug = (tag, message)=>{\n      if(tag=='notify' && message=='Capturing finished.'){\n        this.onImage.emit( drawImageArrayToCanvas(dataImgArray) )\n      }\n    }\n\n    //method intended to live within window memory\n    this.onCapture = ()=>{\n      dataImgArray.length = 0\n      videoObject.save()\n    }\n\n    //method intended to live within window memory\n    this.onSave = (data) => {\n      dataImgArray.push(data)\n    }\n\n    //Flash swf file expects window.webcam to exist as communication bridge\n    window['webcam'] = this\n  }\n\n\n  captureToCanvas():Promise<Canvas>{\n    console.log('333', this.videoObject)\n    return new Promise((res,rej)=>{\n      const subscription = this.onImage.subscribe(img=>{\n        res(img)\n        subscription.unsubscribe()\n      })\n      this.videoObject.capture()\n    })\n  }\n\n  captureBase64(mime?):Promise<string>{\n    return this.captureToCanvas()\n    .then( (canvas:Canvas)=>canvas.toDataURL(mime || 'image/jpeg') )\n  }\n\n  /**\n   * Add <param>'s into fallback object\n   * @param cam - Flash web camera instance\n   * @returns {void}\n   */\n  addFallbackParams(options:Options): any {\n    const paramFlashVars = document.createElement('param');\n    paramFlashVars.name = 'FlashVars';\n    paramFlashVars.value = 'mode=' + options.fallbackMode + '&amp;quality=' + options.fallbackQuality;\n    this.videoObject.appendChild(paramFlashVars);\n\n    const paramAllowScriptAccess = document.createElement('param');\n    paramAllowScriptAccess.name = 'allowScriptAccess';\n    paramAllowScriptAccess.value = 'always';\n    this.videoObject.appendChild(paramAllowScriptAccess);\n\n    //is this even needed?\n    this.videoObject.classid = 'clsid:D27CDB6E-AE6D-11cf-96B8-444553540000';\n    \n    const paramMovie = document.createElement('param');\n    paramMovie.name = 'movie';\n    paramMovie.value = options.fallbackSrc;\n    this.videoObject.appendChild(paramMovie);\n    this.videoObject.data = options.fallbackSrc;\n  }\n}\n\nexport function videoInputsByDevices(devices:MediaDeviceInfo[]):MediaDeviceInfo[]{\n  return devicesByKind(devices,'videoinput')\n}\n\nexport function audioInputsByDevices(devices:MediaDeviceInfo[]):MediaDeviceInfo[]{\n  return devicesByKind(devices,'audioinput')\n}\n\nexport function audioOutputsByDevices(devices:MediaDeviceInfo[]):MediaDeviceInfo[]{\n  return devicesByKind(devices,'audiooutput')\n}\n\nexport function devicesByKind(devices:MediaDeviceInfo[], kind:string):MediaDeviceInfo[]{\n  return devices.filter(device=>device.kind===kind)\n}\n\nexport function promiseDeviceById(id:string):Promise<MediaDeviceInfo> {\n  return promiseDevices().then( devices=>devices.find(device=>device.deviceId==id) )\n}\n\nexport function promiseDevices():Promise<MediaDeviceInfo[]> {\n  //const x:Promise<MediaDeviceInfo[]> = browser.mediaDevices.enumerateDevices().then( devices=>devices )\n  return browser.mediaDevices.enumerateDevices()\n}"]}